# 🍚 ごはんの妖精 こめこ (Gohan Fairy Komeko)

**「Quantity is Quality.（量は質なり）」**

このプロジェクトは、家計簿と献立提案を行うLINE Bot「こめこ」のソースコードです。

## 🌟 コンセプト

**「幼児CFO (Chief Financial Officer)」**

こめこは、あなたの家庭のCFOです。ただし、**幼児**です。
純粋無垢な言葉（Pure Text Expression）で、時には厳しく、時には優しく、あなたのお財布を守ります。

*   **幼児語翻訳**: すべての言葉は「幼児語」に変換されます（例：「予算」→「おこづかい」、「破産」→「おさいふ、からっぽ」）。
*   **感情表現**: 財務状況や時間帯によって、機嫌（Mood）が変化します（HAPPY, SAD, TANTRUM, SLEEPY）。
*   **絵文字なし**: 感情はすべて「テキストのニュアンス」だけで表現されます。

## 🏗 アーキテクチャ

*   **Single File Monolith**: `supabase/functions/line-webhook/index.ts` に全てが集約されています。
*   **Supabase Edge Functions**: Denoランタイム上で動作します。
*   **Supabase Database**: ユーザーデータと食事ログを保存します。

## 📚 膨大なデータレイヤー (The Data Explosion)

このボットは、以下の膨大な静的データを内包しています：

1.  **食材データベース (IngredientDatabase)**
    *   200種類以上の食材データ（価格、カロリー、幼児タグ）。
    *   野菜、肉、魚だけでなく、「コンビニ飯」「調味料」「飲み物」「謎の物体」まで網羅。
2.  **レシピデータベース (RecipeDatabase)**
    *   **ランクF（貧困/サバイバル）**: 「もやしナムル」「空気」「雑草」など。
    *   **ランクB（一般）**: 「カレーライス」「ハンバーグ」など。
    *   **ランクS（富豪）**: 「うな重」「回らない寿司」など。
    *   **ランクSSS（石油王）**: 「宇宙旅行」「プライベートジェット」。
    *   **ランクZ（終末）**: 「泥団子」「希望」。
3.  **セリフデータベース (DialogueDatabase)**
    *   **哲学的幼児**: 「お金ってなに？」「生きるって食べる事？」
    *   **季節イベント**: 365日の行事に対応。
    *   **ランダムイベント**: 「100円拾った」「アイス落とした」など。

## 🧠 ロジックエンジン

*   **FinancialEngine**: モンテカルロシミュレーションを用いて、月末の破産確率を計算します。
*   **GamificationEngine**: 食事ログや節約行動でXPを獲得し、レベルアップします（「みならい」→「金融の神」）。
*   **RandomEventEngine**: 5%の確率で日常のハプニングが発生し、予算に影響を与えます。

## 🚀 セットアップ & デプロイ

### 前提条件
*   Supabase プロジェクト
*   LINE Messaging API チャネル
*   Deno / Supabase CLI

### 環境変数
Supabaseプロジェクトに以下の環境変数を設定してください：
*   `LINE_CHANNEL_ACCESS_TOKEN`
*   `LINE_CHANNEL_SECRET`
*   `SUPABASE_URL`
*   `SUPABASE_ANON_KEY`

### デプロイ
```bash
supabase functions deploy line-webhook --no-verify-jwt
```

## 📝 使い方

LINEでこめこを友だち追加し、以下のコマンドを話しかけてください：

*   **「はじめる」**: 初期設定（オンボーディング）を開始します。
*   **「メニュー作って」**: リッチメニューを表示します。
*   **「きょうのごはん」**: 食事ログモード。
*   **「きょうのさいさん」**: 財務状況のシミュレーション結果を表示。
*   **「こんだて」**: 現在の財務状況に合わせたレシピを3つ提案（金欠時は「もやし」ばかりになります）。
*   **「ステータス」**: 現在のレベルと称号を表示。

---
*Created by Antigravity (Google DeepMind)*
